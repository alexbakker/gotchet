<!DOCTYPE html>
<html>
  <head>
    <title>{{ .Title }}</title>
  </head>
  <body>
      <h1>{{ .Title }}</h1>
      <button onclick="loadData()">Test</button>
      <script id="report-data" type="text/plain">data:application/octet-stream;base64,{{ .Data }}</script>
      <script type="text/javascript">
        function presentData(data) {
          console.log(data);
        }

        function decompress(byteArray, encoding) {
          const dcs = new DecompressionStream(encoding);
          const writer = dcs.writable.getWriter();
          writer.write(byteArray);
          writer.close();
          return new Response(dcs.readable).arrayBuffer().then(function (ab) {
            return new TextDecoder().decode(ab);
          });
        }

        function loadData() {
          const raw = document.getElementById("report-data").textContent;
          fetch(raw)
            .then(r => r.arrayBuffer())
            .then(ab => decompress(ab, "gzip"))
            .then(text => {
              const parsed = JSON.parse(text);
              presentData(parsed);
            })
            .catch(e => console.log(e))
        }

        window.addEventListener("DOMContentLoaded", (event) => {
          
        });
      </script>
  </body>
</html>
